<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interpretador de CST ICMS - Regime Normal</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
    body{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;}
    .container{max-width:1000px;margin:0 auto;background:white;border-radius:15px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden;}
    header{background:linear-gradient(135deg,#2c3e50,#34495e);color:white;padding:20px 30px;text-align:center;position:relative;}
    h1{font-size:2.0rem;margin-bottom:6px;}
    .subtitle{opacity:.9;font-size:0.98rem;margin-bottom:8px;}
    .lang-group{position:absolute;top:14px;right:16px;display:flex;gap:8px;}
    .lang-btn{background:#3498db;color:white;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;font-weight:600;transition:background .2s;}
    .lang-btn:hover{background:#2980b9;}
    .lang-btn.active{background:#1f6fb2;box-shadow:0 2px 6px rgba(0,0,0,0.15);}
    .input-section{padding:30px;background:#f8f9fa;}
    .input-group{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
    input{flex:1;padding:15px;border:2px solid #e9ecef;border-radius:8px;font-size:1.05rem;text-align:center;min-width:160px;}
    input:focus{outline:none;border-color:#3498db;}
    button{background:#2ecc71;color:white;border:none;padding:12px 18px;border-radius:8px;cursor:pointer;font-size:1.02rem;font-weight:600;transition:background .3s;}
    button:hover{background:#27ae60;}
    .result-section{padding:0 30px 30px;}
    .result-card{background:white;border-radius:10px;padding:18px;margin-bottom:16px;box-shadow:0 5px 15px rgba(0,0,0,.08);border-left:5px solid #3498db;}
    .result-title{color:#2c3e50;font-size:1.05rem;margin-bottom:10px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
    .origin-badge,.tax-badge{display:inline-block;color:white;padding:4px 10px;border-radius:20px;font-size:.82rem;margin-right:8px;}
    .origin-badge{background:#e74c3c;}
    .tax-badge{background:#9b59b6;}
    .features{background:#fff3cd;border:1px solid #ffeaa7;border-radius:8px;padding:10px;margin-top:10px;}
    .feature-item{display:flex;align-items:center;gap:10px;margin-bottom:6px;}
    .error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;border-radius:8px;padding:14px;text-align:center;}
    .valid-csts{background:#d1ecf1;border:1px solid #bee5eb;border-radius:8px;padding:12px;margin-top:12px;}
    .valid-csts h4{color:#0c5460;margin-bottom:8px;}
    .cst-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:6px;font-size:.9rem;}
    .cst-item{background:white;padding:8px;border-radius:4px;text-align:center;border:1px solid #b8daff;cursor:pointer;}
    .cst-item:hover{background:#f1f8ff;}
    .specific-card{background:#eef7ff;border-left:5px solid #2b9be6;padding:12px;border-radius:8px;margin-top:10px;}
    .about-card{background:#f7f9fb;border:1px solid #e3eefc;border-radius:8px;padding:14px;margin:14px 30px;}
    footer{padding:12px;text-align:center;color:#6c757d;font-size:.88rem;}
    a.small-link{color:#3498db;text-decoration:none;}
    pre.small {white-space:pre-wrap;font-family:inherit;font-size:0.95rem;}
    .btn-link {background:transparent;border:1px solid #cce5ff;color:#2b9be6;padding:6px 10px;border-radius:6px;cursor:pointer;}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 id="title">üîç Interpretador de CST ICMS</h1>
      <p class="subtitle" id="subtitle">Regime Normal - Baseado na Tabela Oficial</p>

      <div class="lang-group" role="tablist" aria-label="Escolha do idioma">
        <button class="lang-btn" id="btnPT" aria-pressed="true">PT</button>
        <button class="lang-btn" id="btnEN" aria-pressed="false">EN</button>
        <button class="lang-btn" id="btnZH" aria-pressed="false">‰∏≠Êñá</button>
      </div>
    </header>

    <div class="input-section">
      <div class="input-group">
        <input type="text" id="cstInput" placeholder="Digite o CST (ex: 000, 170, 541)" maxlength="3" pattern="[0-9]{3}">
        <button id="interpretBtn">Interpretar CST</button>
        <button class="btn-link" id="toggleAboutBtn">Sobre / About / ÂÖ≥‰∫é</button>
      </div>

      <div class="valid-csts">
        <h4 id="validTitle">üìã CSTs V√°lidos do Regime Normal</h4>
        <div class="cst-grid" id="validCstsGrid"></div>
      </div>
    </div>

    <div id="aboutSection" class="about-card" style="display:none;">
      <!-- Conte√∫do din√¢mico via JS -->
    </div>

    <div class="result-section" id="resultSection">
      <div class="result-card">
        <p id="emptyMsg">Digite um c√≥digo CST acima para ver sua interpreta√ß√£o</p>
      </div>
    </div>

    <footer>
      Desenhado por <strong>watheusgomes-bit</strong> ¬∑ <a class="small-link" href="https://github.com/watheusgomes-bit/interpretador-cst-icms" target="_blank" rel="noopener">Reposit√≥rio</a>
    </footer>
  </div>

  <script>
    // LOCALES (pt / en / zh) com About/processamento
    const locales = {
      'pt': {
        title: 'üîç Interpretador de CST ICMS',
        subtitle: 'Regime Normal - Baseado na Tabela Oficial',
        inputPlaceholder: 'Digite o CST (ex: 000, 170, 541)',
        interpretBtn: 'Interpretar CST',
        validTitle: 'üìã CSTs V√°lidos do Regime Normal',
        emptyMsg: 'Digite um c√≥digo CST acima para ver sua interpreta√ß√£o',
        alerts: {
          enterCst: '‚ö†Ô∏è Digite um c√≥digo CST',
          invalidFormat: '‚ùå CST deve conter exatamente 3 d√≠gitos num√©ricos',
          notValid: 'n√£o √© v√°lido para regime normal.',
          consultList: 'Consulte a lista de CSTs v√°lidos acima.'
        },
        aboutTitle: 'üìä PROCESSAMENTO EM DUAS CAMADAS',
        aboutLayers: [
          'CAMADA 1 - ORIGEM DA MERCADORIA (Primeiro D√≠gito):',
          '0, 3, 4, 5, 8 ‚Üí Mercadorias Nacionais (com varia√ß√µes de conte√∫do importado)',
          '1, 6 ‚Üí Mercadorias Estrangeiras - Importa√ß√£o Direta',
          '2, 7 ‚Üí Mercadorias Estrangeiras - Mercado Interno',
          '',
          'CAMADA 2 - TRIBUTA√á√ÉO ICMS (Dois √öltimos D√≠gitos):',
          '00-20 ‚Üí Opera√ß√µes tributadas normais',
          '30-41 ‚Üí Opera√ß√µes isentas ou n√£o tributadas',
          '50-51 ‚Üí Opera√ß√µes com suspens√£o ou diferimento',
          '60-70 ‚Üí Opera√ß√µes com substitui√ß√£o tribut√°ria',
          '90 ‚Üí Demais opera√ß√µes',
          '',
          'DESCRI√á√ÉO DO SISTEMA:',
          '"O CST Interpreter √© um sistema especializado que aplica algoritmos de interpreta√ß√£o fiscal baseados na estrutura oficial do Conv√™nio ICMS 15/1970. A ferramenta realiza:',
          'üîç DECOMPOSI√á√ÉO AUTOM√ÅTICA - Separa o c√≥digo em origem + tributa√ß√£o',
          'üìö CONSULTA √ÄS TABELAS OFICIAIS - Acessa Tabela A (origens) e Tabela B (tributa√ß√µes)',
          'üß† AN√ÅLISE CONTEXTUAL - Identifica caracter√≠sticas espec√≠ficas de cada combina√ß√£o',
          'üí° GER√äNCIA DE RECOMENDA√á√ïES - Sugere a√ß√µes baseadas no regime tribut√°rio identificado',
          '',
          'EXEMPLO DE PROCESSAMENTO ‚Äî ENTRADA: 160',
          'SA√çDA ESTRUTURADA (RESUMO):',
          'üè∑Ô∏è CST: 160',
          'üìç Origem: Estrangeira ‚Äì Importa√ß√£o direta...',
          'üí∞ Tributa√ß√£o: ICMS cobrado anteriormente por ST',
          'üìã Significado: ICMS j√° foi pago via substitui√ß√£o tribut√°ria',
          'üéØ Aplica√ß√£o: Opera√ß√µes onde o contribuinte √© o substitu√≠do',
          'üîç Caracter√≠sticas: Mercadoria estrangeira, ICMS pr√©-recolhido',
          'üí° Recomenda√ß√µes: Verificar se o ICMS-ST foi efetivamente recolhido',
          '',
          'DIFERENCIAIS T√âCNICOS:',
          '‚úÖ Fidelidade Legislativa - Baseado exclusivamente nas tabelas oficiais',
          '‚úÖ Decomposi√ß√£o Estruturada - Segue o padr√£o Origem + Tributa√ß√£o',
          '‚úÖ Valida√ß√£o Cruzada - Verifica combina√ß√µes v√°lidas conforme a tabela consolidada',
          '‚úÖ Intelig√™ncia Contextual - Adapta recomenda√ß√µes ao perfil de cada CST',
          '‚úÖ Transpar√™ncia Processual - Mostra o racioc√≠nio por tr√°s de cada interpreta√ß√£o'
        ]
      },
      'en': {
        title: 'üîç CST ICMS Interpreter',
        subtitle: 'Normal Regime - Based on Official Table',
        inputPlaceholder: 'Enter CST (e.g.: 000, 170, 541)',
        interpretBtn: 'Interpret CST',
        validTitle: 'üìã Valid CSTs for Normal Regime',
        emptyMsg: 'Type a CST code above to see its interpretation',
        alerts: {
          enterCst: '‚ö†Ô∏è Enter a CST code',
          invalidFormat: '‚ùå CST must be exactly 3 numeric digits',
          notValid: 'is not valid for normal regime.',
          consultList: 'Check the list of valid CSTs above.'
        },
        aboutTitle: 'üìä TWO-LAYER PROCESSING',
        aboutLayers: [
          'LAYER 1 - ORIGIN OF THE GOODS (First Digit):',
          '0, 3, 4, 5, 8 ‚Üí National goods (with variations of import content)',
          '1, 6 ‚Üí Foreign goods - Direct import',
          '2, 7 ‚Üí Foreign goods - Acquired in domestic market',
          '',
          'LAYER 2 - ICMS TAXATION (Last Two Digits):',
          '00-20 ‚Üí Normally taxed operations',
          '30-41 ‚Üí Exempt or non-taxed operations',
          '50-51 ‚Üí Suspension or deferment operations',
          '60-70 ‚Üí Tax substitution operations',
          '90 ‚Üí Other operations',
          '',
          'SYSTEM DESCRIPTION:',
          '"The CST Interpreter is a specialized system applying fiscal interpretation algorithms based on the official structure of Conv√™nio ICMS 15/1970. The tool performs:',
          'üîç AUTOMATIC DECOMPOSITION - Splits the code into origin + taxation',
          'üìö LOOKUP TO OFFICIAL TABLES - Accesses Table A (origins) and Table B (taxations)',
          'üß† CONTEXTUAL ANALYSIS - Identifies specific characteristics for each combination',
          'üí° RECOMMENDATION MANAGEMENT - Suggests actions based on identified tax regime',
          '',
          'PROCESSING EXAMPLE ‚Äî INPUT: 160',
          'STRUCTURED OUTPUT (SUMMARY):',
          'üè∑Ô∏è CST: 160',
          'üìç Origin: Foreign ‚Äî Direct import...',
          'üí∞ Taxation: ICMS previously collected by ST',
          'üìã Meaning: ICMS was already paid via tax substitution',
          'üéØ Application: Operations where the taxpayer is the substituted party',
          'üîç Characteristics: Foreign goods, ICMS pre-collected',
          'üí° Recommendations: Verify ICMS-ST was actually collected',
          '',
          'TECHNICAL DIFFERENTIATORS:',
          '‚úÖ Legislative fidelity - Based exclusively on official tables',
          '‚úÖ Structured decomposition - Follows Origin + Taxation pattern',
          '‚úÖ Cross validation - Verifies valid combinations according to the consolidated table',
          '‚úÖ Contextual intelligence - Adapts recommendations to each CST profile',
          '‚úÖ Process transparency - Shows the reasoning behind each interpretation'
        ]
      },
      'zh': {
        title: 'üîç CST ICMS Ëß£ÈáäÂô®',
        subtitle: '‰∏ÄËà¨Âà∂Â∫¶ - Âü∫‰∫éÂÆòÊñπË°®Ê†º',
        inputPlaceholder: 'ËæìÂÖ• CSTÔºà‰æãÂ¶ÇÔºö000, 170, 541Ôºâ',
        interpretBtn: 'Ëß£Èáä CST',
        validTitle: 'üìã ‰∏ÄËà¨Âà∂Â∫¶ÊúâÊïàÁöÑ CST',
        emptyMsg: 'Âú®‰∏äÊñπËæìÂÖ• CST ‰ª£Á†Å‰ª•Êü•ÁúãÂÖ∂Ëß£Èáä',
        alerts: {
          enterCst: '‚ö†Ô∏è ËØ∑ËæìÂÖ• CST ‰ª£Á†Å',
          invalidFormat: '‚ùå CST ÂøÖÈ°ª‰∏∫ 3 ‰ΩçÊï∞Â≠ó',
          notValid: '‰∏çÈÄÇÁî®‰∫é‰∏ÄËà¨Âà∂Â∫¶„ÄÇ',
          consultList: 'ËØ∑Êü•Áúã‰∏äÊñπÁöÑÊúâÊïà CST ÂàóË°®„ÄÇ'
        },
        aboutTitle: 'üìä ÂèåÂ±ÇÂ§ÑÁêÜÊµÅÁ®ã',
        aboutLayers: [
          'Á¨¨ 1 Â±Ç - Ë¥ßÁâ©Êù•Ê∫êÔºàÈ¶ñ‰ΩçÊï∞Â≠óÔºâÔºö',
          '0, 3, 4, 5, 8 ‚Üí ÂõΩÂÜÖË¥ßÁâ©ÔºàÊúâ‰∏çÂêåËøõÂè£ÊàêÂàÜÔºâ',
          '1, 6 ‚Üí ÂõΩÂ§ñË¥ßÁâ© - Áõ¥Êé•ËøõÂè£',
          '2, 7 ‚Üí ÂõΩÂ§ñË¥ßÁâ© - ÂõΩÂÜÖÂ∏ÇÂú∫Ë¥≠ÂÖ•',
          '',
          'Á¨¨ 2 Â±Ç - ICMS Á®éÂä°ÔºàÊúÄÂêé‰∏§‰ΩçÊï∞Â≠óÔºâÔºö',
          '00-20 ‚Üí ‰∏ÄËà¨ÂæÅÁ®éÊìç‰Ωú',
          '30-41 ‚Üí ÂÖçÁ®éÊàñ‰∏çÂæÅÁ®éÊìç‰Ωú',
          '50-51 ‚Üí ÊöÇÂÅúÊàñÈÄíÂª∂Êìç‰Ωú',
          '60-70 ‚Üí Êõø‰ª£ÂæÅÁ®éÊìç‰Ωú',
          '90 ‚Üí ÂÖ∂‰ªñÊìç‰Ωú',
          '',
          'Á≥ªÁªüÊèèËø∞Ôºö',
          '‚ÄúCST Interpreter ÊòØ‰∏Ä‰∏™Âü∫‰∫é Conv√™nio ICMS 15/1970 ÂÆòÊñπÁªìÊûÑÁöÑÁ®éÂä°Ëß£ÈáäÁ≥ªÁªü„ÄÇÂ∑•ÂÖ∑ÊâßË°åÔºö',
          'üîç Ëá™Âä®ÂàÜËß£ - Â∞Ü‰ª£Á†ÅÊãÜÂàÜ‰∏∫Êù•Ê∫ê + Á®éÂä°',
          'üìö Êü•ËØ¢ÂÆòÊñπË°® - ËÆøÈóÆË°® AÔºàÊù•Ê∫êÔºâÂíåË°® BÔºàÁ®éÂä°Ôºâ',
          'üß† ‰∏ä‰∏ãÊñáÂàÜÊûê - ËØÜÂà´ÊØèÁßçÁªÑÂêàÁöÑÁâπÂæÅ',
          'üí° Âª∫ËÆÆÁÆ°ÁêÜ - Ê†πÊçÆËØÜÂà´ÁöÑÁ®éÂà∂Âª∫ËÆÆÊìç‰Ωú',
          '',
          'Â§ÑÁêÜÁ§∫‰æã ‚Äî ËæìÂÖ•Ôºö160',
          'ÁªìÊûÑÂåñËæìÂá∫ÔºàÊëòË¶ÅÔºâÔºö',
          'üè∑Ô∏è CST: 160',
          'üìç Êù•Ê∫êÔºöÂõΩÂ§ñ ‚Äî Áõ¥Êé•ËøõÂè£‚Ä¶‚Ä¶',
          'üí∞ Á®éÂä°ÔºöICMS Â∑≤Áî± ST ÂÖàË°åÂæÅÊî∂',
          'üìã Âê´‰πâÔºöICMS Â∑≤ÈÄöËøáÊõø‰ª£ÂæÅÁ®éÁº¥Á∫≥',
          'üéØ ÈÄÇÁî®ÔºöÁ∫≥Á®é‰∫∫‰∏∫Ë¢´Êõø‰ª£ÊñπÁöÑÊìç‰Ωú',
          'üîç ÁâπÂæÅÔºöÂõΩÂ§ñË¥ßÁâ©ÔºåICMS Â∑≤È¢ÑÁº¥',
          'üí° Âª∫ËÆÆÔºöÊ†∏ÂÆû ICMS-ST ÊòØÂê¶Â∑≤ÂÆûÈôÖÁº¥Á∫≥',
          '',
          'ÊäÄÊúØ‰ºòÂäøÔºö',
          '‚úÖ Á´ãÊ≥ï‰∏ÄËá¥ÊÄß - ÂÆåÂÖ®Âü∫‰∫éÂÆòÊñπË°®',
          '‚úÖ ÁªìÊûÑÂåñÂàÜËß£ - ÈÅµÂæ™ Êù•Ê∫ê + Á®éÂä° Ê®°Âºè',
          '‚úÖ ‰∫§ÂèâÈ™åËØÅ - Ê†πÊçÆÂêàÂπ∂Ë°®È™åËØÅÊúâÊïàÁªÑÂêà',
          '‚úÖ ‰∏ä‰∏ãÊñáÊô∫ËÉΩ - ÈíàÂØπÊØè‰∏™ CST ÈÖçÁΩÆÂª∫ËÆÆ',
          '‚úÖ ÊµÅÁ®ãÈÄèÊòé - Â±ïÁ§∫ÊØèÊ¨°Ëß£ÈáäÁöÑÊé®ÁêÜ'
        ]
      }
    };

    // BANCO DE DADOS COMPLETO - 99 CSTs V√ÅLIDOS
    const cstDatabase_pt = {
      origens: {
        "0": "Nacional, exceto as indicadas nos c√≥digos 3, 4, 5 e 8",
        "1": "Estrangeira ‚Äì Importa√ß√£o direta, exceto a indicada no c√≥digo 6",
        "2": "Estrangeira ‚Äì Adquirida no mercado interno, exceto a indicada no c√≥digo 7",
        "3": "Nacional, mercadoria ou bem com Conte√∫do de Importa√ß√£o superior a 40% e igual ou inferior a 70%",
        "4": "Nacional, cuja produ√ß√£o tenha sido feita em conformidade com os processos produtivos b√°sicos de que tratam o Decreto-Lei n¬∫ 288/1967, e as Leis n¬∫s 8.248/1991, 8.387/1991, 10.176/2001 e 11.484/2007",
        "5": "Nacional, mercadoria ou bem com Conte√∫do de Importa√ß√£o inferior ou igual a 40%",
        "6": "Estrangeira ‚Äì Importa√ß√£o direta, sem similar nacional, constante em lista de Resolu√ß√£o Camex e g√°s natural",
        "7": "Estrangeira ‚Äì Adquirida no mercado interno, sem similar nacional, constante em lista de Resolu√ß√£o Camex e g√°s natural",
        "8": "Nacional ‚Äì Mercadoria ou bem com Conte√∫do de Importa√ß√£o superior a 70%"
      },

      tributacoes: {
        "00": {
          descricao: "Tributada integralmente",
          significado: "ICMS calculado sobre o valor total da opera√ß√£o",
          aplicacao: "Opera√ß√µes normais dentro do estado"
        },
        "10": {
          descricao: "Tributada e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria",
          significado: "ICMS normal + ICMS por substitui√ß√£o tribut√°ria",
          aplicacao: "Opera√ß√µes com ST onde o contribuinte √© o substituto tribut√°rio"
        },
        "20": {
          descricao: "Com redu√ß√£o de base de c√°lculo",
          significado: "Base de c√°lculo reduzida para c√°lculo do ICMS",
          aplicacao: "Produtos com incentivo fiscal ou al√≠quotas diferenciadas"
        },
        "30": {
          descricao: "Isenta ou n√£o tributada e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria",
          significado: "Opera√ß√£o isenta de ICMS pr√≥prio, mas com ST",
          aplicacao: "Produtos isentos que t√™m substitui√ß√£o tribut√°ria"
        },
        "40": {
          descricao: "Isenta",
          significado: "N√£o h√° incid√™ncia de ICMS na opera√ß√£o",
          aplicacao: "Opera√ß√µes com imunidade ou isen√ß√£o espec√≠fica"
        },
        "41": {
          descricao: "N√£o tributada",
          significado: "Opera√ß√£o fora do campo de incid√™ncia do ICMS",
          aplicacao: "Opera√ß√µes que n√£o se enquadram na legisla√ß√£o do ICMS"
        },
        "50": {
          descricao: "Suspens√£o",
          significado: "ICMS suspenso temporariamente",
          aplicacao: "Opera√ß√µes com diferimento ou suspens√£o por regime especial"
        },
        "51": {
          descricao: "Diferimento",
          significado: "ICMS adiado para opera√ß√£o futura",
          aplicacao: "ICMS ser√° pago em etapa posterior da cadeia"
        },
        "60": {
          descricao: "ICMS cobrado anteriormente por substitui√ß√£o tribut√°ria",
          significado: "ICMS j√° foi pago via substitui√ß√£o tribut√°ria",
          aplicacao: "Opera√ß√µes onde o contribuinte √© o substitu√≠do"
        },
        "70": {
          descricao: "Com redu√ß√£o de base de c√°lculo e cobran√ßa do ICMS por substitui√ß√£o tribut√°ria",
          significado: "Base reduzida + substitui√ß√£o tribut√°ria",
          aplicacao: "Produtos com incentivo fiscal e que t√™m ST"
        },
        "90": {
          descricao: "Outras",
          significado: "Demais hip√≥teses de tributa√ß√£o",
          aplicacao: "Regimes especiais ou casos n√£o previstos nos demais c√≥digos"
        }
      },

      // TODOS OS 99 CSTs V√ÅLIDOS
      cstsValidos: [
        // Tributada integralmente (00) - 9
        "000", "100", "200", "300", "400", "500", "600", "700", "800",
        // Tributada com ST (10) - 9
        "010", "110", "210", "310", "410", "510", "610", "710", "810",
        // Com redu√ß√£o BC (20) - 9
        "020", "120", "220", "320", "420", "520", "620", "720", "820",
        // Isenta/N√£o tributada com ST (30) - 9
        "030", "130", "230", "330", "430", "530", "630", "730", "830",
        // Isenta (40) - 9
        "040", "140", "240", "340", "440", "540", "640", "740", "840",
        // N√£o tributada (41) - 9
        "041", "141", "241", "341", "441", "541", "641", "741", "841",
        // Suspens√£o (50) - 9
        "050", "150", "250", "350", "450", "550", "650", "750", "850",
        // Diferimento (51) - 9
        "051", "151", "251", "351", "451", "551", "651", "751", "851",
        // ICMS cobrado anteriormente (60) - 9 (INCLUINDO 160 e 660)
        "060", "160", "260", "360", "460", "560", "660", "760", "860",
        // Redu√ß√£o BC + ST (70) - 9 (INCLUINDO 170 e 670)
        "070", "170", "270", "370", "470", "570", "670", "770", "870",
        // Outras (90) - 9
        "090", "190", "290", "390", "490", "590", "690", "790", "890"
      ]
    };

    // Vers√µes em ingl√™s e chin√™s (simplificadas para exemplo)
    const cstDatabase_en = { ...cstDatabase_pt };
    const cstDatabase_zh = { ...cstDatabase_pt };

    // DETALHES ESPEC√çFICOS PARA CSTs CR√çTICOS
    const cstSpecifics = {
      '160': {
        features: ["üåç Mercadoria estrangeira", "üë• ICMS j√° recolhido anteriormente", "üîÑ Envolve Substitui√ß√£o Tribut√°ria"],
        recommendations: ["Verificar se o ICMS-ST foi efetivamente recolhido", "Confirmar documenta√ß√£o de importa√ß√£o"]
      },
      '170': {
        features: ["üåç Mercadoria estrangeira", "üìâ Base de c√°lculo reduzida", "üîÑ Envolve Substitui√ß√£o Tribut√°ria"],
        recommendations: ["Verificar obriga√ß√£o de recolhimento do ICMS-ST", "Confirmar percentual de redu√ß√£o aplic√°vel"]
      },
      '660': {
        features: ["üåç Mercadoria estrangeira especial", "üë• ICMS j√° recolhido anteriormente", "üîÑ Envolve Substitui√ß√£o Tribut√°ria"],
        recommendations: ["Verificar se o ICMS-ST foi recolhido", "Confirmar enquadramento na lista Camex"]
      },
      '670': {
        features: ["üåç Mercadoria estrangeira especial", "üìâ Base de c√°lculo reduzida", "üîÑ Envolve Substitui√ß√£o Tribut√°ria"],
        recommendations: ["Verificar ICMS-ST", "Confirmar percentual de redu√ß√£o", "Validar lista Camex"]
      }
    };

    // SISTEMA PRINCIPAL
    let currentLocale = 'pt';

    function getCstDB() {
      if (currentLocale === 'en') return cstDatabase_en;
      if (currentLocale === 'zh') return cstDatabase_zh;
      return cstDatabase_pt;
    }

    class CSTInterpreter {
      constructor(cstCode) {
        this.cstCode = cstCode.toString().padStart(3, '0');
        this.origem = this.cstCode[0];
        this.tributacao = this.cstCode.substring(1);
      }

      isValid() {
        return getCstDB().cstsValidos.includes(this.cstCode);
      }

      getOrigemInfo() {
        return {
          codigo: this.origem,
          descricao: getCstDB().origens[this.origem] || "Origem desconhecida"
        };
      }

      getTributacaoInfo() {
        const info = getCstDB().tributacoes[this.tributacao];
        return info ? {
          codigo: this.tributacao,
          ...info
        } : null;
      }

      detectarCaracteristicas() {
        const features = [];
        const trib = this.tributacao;

        // Caracter√≠sticas espec√≠ficas do CST
        if (cstSpecifics[this.cstCode]) {
          features.push(...cstSpecifics[this.cstCode].features);
          return features;
        }

        // Caracter√≠sticas gen√©ricas
        if (trib === '00') features.push("üí≥ Tributa√ß√£o normal sem particularidades");
        if (['10', '30', '70'].includes(trib)) features.push("üîÑ Envolve Substitui√ß√£o Tribut√°ria");
        if (['20', '70'].includes(trib)) features.push("üìâ Base de c√°lculo reduzida");
        if (['40', '41'].includes(trib)) features.push("üÜì Isen√ß√£o ou n√£o tributa√ß√£o");
        if (['50', '51'].includes(trib)) features.push("‚è≥ Suspens√£o ou diferimento");
        if (trib === '60') features.push("üë• ICMS j√° recolhido anteriormente");
        if (trib === '90') features.push("‚öñÔ∏è Caso especial - verificar legisla√ß√£o");

        // Caracter√≠sticas da origem
        if (['1', '2', '6', '7'].includes(this.origem)) features.push("üåç Mercadoria estrangeira");
        if (['3', '5', '8'].includes(this.origem)) features.push("üè≠ Conte√∫do de importa√ß√£o envolvido");
        if (['4'].includes(this.origem)) features.push("üèÜ Produ√ß√£o com incentivos fiscais");

        return features;
      }

      gerarRecomendacoes() {
        // Recomenda√ß√µes espec√≠ficas
        if (cstSpecifics[this.cstCode]) {
          return cstSpecifics[this.cstCode].recommendations;
        }

        const recommendations = [];
        const trib = this.tributacao;

        if (['10', '30', '70'].includes(trib)) {
          recommendations.push("Verificar obriga√ß√£o de recolhimento do ICMS-ST");
        }
        if (['20', '70'].includes(trib)) {
          recommendations.push("Confirmar percentual de redu√ß√£o da base de c√°lculo");
        }
        if (['40', '41'].includes(trib)) {
          recommendations.push("Manter documenta√ß√£o que comprove a isen√ß√£o/n√£o tributa√ß√£o");
        }
        if (['50', '51'].includes(trib)) {
          recommendations.push("Acompanhar quando o ICMS ser√° devido");
        }
        if (trib === '60') {
          recommendations.push("Verificar se o ICMS-ST foi efetivamente recolhido");
        }
        if (trib === '90') {
          recommendations.push("Consultar legisla√ß√£o espec√≠fica do caso");
        }

        return recommendations.length > 0 ? recommendations : 
          ["Seguir procedimentos normais de tributa√ß√£o"];
      }

      interpretar() {
        if (!this.isValid()) {
          return {
            valido: false,
            erro: `CST ${this.cstCode} ${locales[currentLocale].alerts.notValid}`
          };
        }

        const origemInfo = this.getOrigemInfo();
        const tributacaoInfo = this.getTributacaoInfo();
        const caracteristicas = this.detectarCaracteristicas();
        const recomendacoes = this.gerarRecomendacoes();

        return {
          valido: true,
          cst: this.cstCode,
          origem: origemInfo,
          tributacao: tributacaoInfo,
          caracteristicas: caracteristicas,
          recomendacoes: recomendacoes
        };
      }
    }

    // INTERFACE DO USU√ÅRIO
    function interpretarCST() {
      const input = document.getElementById('cstInput').value.trim();
      const resultSection = document.getElementById('resultSection');
      const L = locales[currentLocale];

      if (!input) {
        resultSection.innerHTML = `<div class="error"><p>${L.alerts.enterCst}</p></div>`;
        return;
      }

      if (!/^\d{3}$/.test(input)) {
        resultSection.innerHTML = `<div class="error"><p>${L.alerts.invalidFormat}</p></div>`;
        return;
      }

      const interpreter = new CSTInterpreter(input);
      const resultado = interpreter.interpretar();

      if (!resultado.valido) {
        resultSection.innerHTML = `
          <div class="error">
            <p>${resultado.erro}</p>
            <p style="margin-top: 10px;">${L.alerts.consultList}</p>
          </div>
        `;
        return;
      }

      // Renderizar resultado
      let html = `
        <div class="result-card">
          <h2 class="result-title">
            üè∑Ô∏è CST: ${resultado.cst}
            <span class="origin-badge">Origem ${resultado.origem.codigo}</span>
            <span class="tax-badge">Tributa√ß√£o ${resultado.tributacao.codigo}</span>
          </h2>
          
          <div class="result-detail">
            <strong>üìç Origem:</strong> ${resultado.origem.descricao}
          </div>
          
          <div class="result-detail">
            <strong>üí∞ Tributa√ß√£o:</strong> ${resultado.tributacao.descricao}
          </div>
          
          <div class="result-detail">
            <strong>üìã Significado:</strong> ${resultado.tributacao.significado}
          </div>
          
          <div class="result-detail">
            <strong>üéØ Aplica√ß√£o:</strong> ${resultado.tributacao.aplicacao}
          </div>
          
          <div class="features">
            <h4>üîç Caracter√≠sticas Identificadas:</h4>
            ${resultado.caracteristicas.map(c => `
              <div class="feature-item">${c}</div>
            `).join('')}
          </div>
          
          <div class="features" style="background: #d4edda; border-color: #c3e6cb;">
            <h4>üí° Recomenda√ß√µes:</h4>
            ${resultado.recomendacoes.map(r => `
              <div class="feature-item">‚Ä¢ ${r}</div>
            `).join('')}
          </div>
        </div>
      `;

      resultSection.innerHTML = html;
    }

    function inicializarCstsValidos() {
      const grid = document.getElementById('validCstsGrid');
      grid.innerHTML = '';
      getCstDB().cstsValidos.forEach(cst => {
        const div = document.createElement('div');
        div.className = 'cst-item';
        div.textContent = cst;
        div.title = `Clicar para preencher: ${cst}`;
        div.style.cursor = 'pointer';
        div.onclick = () => {
          document.getElementById('cstInput').value = cst;
          interpretarCST();
        };
        grid.appendChild(div);
      });
    }

    function renderAbout() {
      const box = document.getElementById('aboutSection');
      const L = locales[currentLocale];
      const lines = [L.aboutTitle, ''].concat(L.aboutLayers);
      box.innerHTML = '<pre class="small">'+lines.join('\n')+'</pre>';
    }

    // EVENT LISTENERS
    document.getElementById('cstInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') interpretarCST();
    });

    document.getElementById('cstInput').addEventListener('input', function(e) {
      this.value = this.value.replace(/[^0-9]/g, '').slice(0, 3);
    });

    document.getElementById('interpretBtn').addEventListener('click', interpretarCST);

    document.getElementById('toggleAboutBtn').addEventListener('click', ()=>{
      const box = document.getElementById('aboutSection');
      box.style.display = box.style.display === 'none' ? 'block' : 'none';
      if (box.style.display === 'block') renderAbout();
    });

    // CONTROLE DE IDIOMA
    const btnPT = document.getElementById('btnPT');
    const btnEN = document.getElementById('btnEN');
    const btnZH = document.getElementById('btnZH');
    const langButtons = { 'pt': btnPT, 'en': btnEN, 'zh': btnZH };

    function setLocale(locale) {
      currentLocale = locale;
      applyLocale();
      inicializarCstsValidos();
      document.getElementById('resultSection').innerHTML = `<div class="result-card"><p>${locales[currentLocale].emptyMsg}</p></div>`;
      renderAbout();
    }

    function applyLocale() {
      const L = locales[currentLocale];
      document.getElementById('title').textContent = L.title;
      document.getElementById('subtitle').textContent = L.subtitle;
      document.getElementById('cstInput').setAttribute('placeholder', L.inputPlaceholder);
      document.getElementById('interpretBtn').textContent = L.interpretBtn;
      document.getElementById('validTitle').textContent = L.validTitle;
      document.getElementById('emptyMsg').textContent = L.emptyMsg;
      
      Object.keys(langButtons).forEach(k => {
        const btn = langButtons[k];
        if (k === currentLocale) btn.classList.add('active'); 
        else btn.classList.remove('active');
      });
    }

    // CONFIGURAR EVENTOS DE IDIOMA
    btnPT.addEventListener('click', () => setLocale('pt'));
    btnEN.addEventListener('click', () => setLocale('en'));
    btnZH.addEventListener('click', () => setLocale('zh'));

    // INICIALIZAR
    document.addEventListener('DOMContentLoaded', () => { 
      applyLocale(); 
      inicializarCstsValidos();
      renderAbout();
    });
  </script>
</body>
</html>
