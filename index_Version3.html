<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interpretador de CST ICMS - Regime Normal</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
    body{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;}
    .container{max-width:900px;margin:0 auto;background:white;border-radius:15px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden;}
    header{background:linear-gradient(135deg,#2c3e50,#34495e);color:white;padding:30px;text-align:center;position:relative;}
    h1{font-size:2.2rem;margin-bottom:10px;}
    .subtitle{opacity:.9;font-size:1.05rem;}
    .lang-toggle{position:absolute;top:15px;right:20px;background:#3498db;color:white;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;font-weight:600;transition:background .3s;}
    .lang-toggle:hover{background:#2980b9;}
    .input-section{padding:30px;background:#f8f9fa;}
    .input-group{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
    input{flex:1;padding:15px;border:2px solid #e9ecef;border-radius:8px;font-size:1.1rem;text-align:center;min-width:160px;}
    input:focus{outline:none;border-color:#3498db;}
    button{background:#2ecc71;color:white;border:none;padding:12px 18px;border-radius:8px;cursor:pointer;font-size:1.05rem;font-weight:600;transition:background .3s;}
    button:hover{background:#27ae60;}
    .result-section{padding:0 30px 30px;}
    .result-card{background:white;border-radius:10px;padding:20px;margin-bottom:20px;box-shadow:0 5px 15px rgba(0,0,0,.08);border-left:5px solid #3498db;}
    .result-title{color:#2c3e50;font-size:1.2rem;margin-bottom:12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
    .origin-badge,.tax-badge{display:inline-block;color:white;padding:4px 10px;border-radius:20px;font-size:.85rem;margin-right:8px;}
    .origin-badge{background:#e74c3c;}
    .tax-badge{background:#9b59b6;}
    .features{background:#fff3cd;border:1px solid #ffeaa7;border-radius:8px;padding:12px;margin-top:12px;}
    .feature-item{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
    .error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;border-radius:8px;padding:18px;text-align:center;}
    .valid-csts{background:#d1ecf1;border:1px solid #bee5eb;border-radius:8px;padding:12px;margin-top:12px;}
    .valid-csts h4{color:#0c5460;margin-bottom:10px;}
    .cst-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:6px;font-size:.9rem;}
    .cst-item{background:white;padding:8px;border-radius:4px;text-align:center;border:1px solid #b8daff;cursor:pointer;}
    footer{padding:12px;text-align:center;color:#6c757d;font-size:.9rem;}
    a.small-link{color:#3498db;text-decoration:none;}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 id="title">üîç Interpretador de CST ICMS</h1>
      <p class="subtitle" id="subtitle">Regime Normal - Baseado na Tabela Oficial</p>
      <button class="lang-toggle" id="langToggle">EN</button>
    </header>

    <div class="input-section">
      <div class="input-group">
        <input type="text" id="cstInput" placeholder="Digite o CST (ex: 000, 170, 541)" maxlength="3" pattern="[0-9]{3}">
        <button id="interpretBtn">Interpretar CST</button>
      </div>

      <div class="valid-csts">
        <h4 id="validTitle">üìã CSTs V√°lidos do Regime Normal</h4>
        <div class="cst-grid" id="validCstsGrid"></div>
      </div>
    </div>

    <div class="result-section" id="resultSection">
      <div class="result-card">
        <p id="emptyMsg">Digite um c√≥digo CST acima para ver sua interpreta√ß√£o</p>
      </div>
    </div>

    <footer>
      Desenhado por <strong>watheusgomes-bit</strong> ¬∑ <a class="small-link" href="https://github.com/watheusgomes-bit/interpretador-cst-icms" target="_blank" rel="noopener">Reposit√≥rio</a>
    </footer>
  </div>

  <script>
    // LOCALES (pt + en)
    const locales = {
      'pt': {
        title: 'üîç Interpretador de CST ICMS',
        subtitle: 'Regime Normal - Baseado na Tabela Oficial',
        inputPlaceholder: 'Digite o CST (ex: 000, 170, 541)',
        interpretBtn: 'Interpretar CST',
        validTitle: 'üìã CSTs V√°lidos do Regime Normal',
        emptyMsg: 'Digite um c√≥digo CST acima para ver sua interpreta√ß√£o',
        alerts: {
          enterCst: '‚ö†Ô∏è Digite um c√≥digo CST',
          invalidFormat: '‚ùå CST deve conter exatamente 3 d√≠gitos num√©ricos',
          notValid: 'n√£o √© v√°lido para regime normal.',
          consultList: 'Consulte a lista de CSTs v√°lidos acima.'
        },
        features: {
          tax_normal: 'üí≥ Tributa√ß√£o normal sem particularidades',
          st: 'üîÑ Envolve Substitui√ß√£o Tribut√°ria',
          reduced_bc: 'üìâ Base de c√°lculo reduzida',
          exemption: 'üÜì Isen√ß√£o ou n√£o tributa√ß√£o',
          suspend_defer: '‚è≥ Suspens√£o ou diferimento',
          icms_paid: 'üë• ICMS j√° recolhido anteriormente',
          special_case: '‚öñÔ∏è Caso especial - verificar legisla√ß√£o',
          foreign: 'üåç Mercadoria estrangeira',
          import_content: 'üè≠ Conte√∫do de importa√ß√£o envolvido',
          incentives: 'üèÜ Produ√ß√£o com incentivos fiscais'
        },
        recommendations: {
          st: 'Verificar obriga√ß√£o de recolhimento do ICMS-ST',
          reduced_bc: 'Confirmar percentual de redu√ß√£o da base de c√°lculo',
          exemption: 'Manter documenta√ß√£o que comprove a isen√ß√£o/n√£o tributa√ß√£o',
          suspend_defer: 'Acompanhar quando o ICMS ser√° devido',
          icms_paid: 'Verificar se o ICMS-ST foi efetivamente recolhido',
          special_case: 'Consultar legisla√ß√£o espec√≠fica do caso',
          default: 'Seguir procedimentos normais de tributa√ß√£o'
        }
      },
      'en': {
        title: 'üîç CST ICMS Interpreter',
        subtitle: 'Normal Regime - Based on Official Table',
        inputPlaceholder: 'Enter CST (e.g.: 000, 170, 541)',
        interpretBtn: 'Interpret CST',
        validTitle: 'üìã Valid CSTs for Normal Regime',
        emptyMsg: 'Type a CST code above to see its interpretation',
        alerts: {
          enterCst: '‚ö†Ô∏è Enter a CST code',
          invalidFormat: '‚ùå CST must be exactly 3 numeric digits',
          notValid: 'is not valid for normal regime.',
          consultList: 'Check the list of valid CSTs above.'
        },
        features: {
          tax_normal: 'üí≥ Normal taxation without special conditions',
          st: 'üîÑ Involves Tax Substitution (ST)',
          reduced_bc: 'üìâ Reduced tax base',
          exemption: 'üÜì Exemption or non-taxation',
          suspend_defer: '‚è≥ Suspension or deferment',
          icms_paid: 'üë• ICMS already collected previously',
          special_case: '‚öñÔ∏è Special case - check legislation',
          foreign: 'üåç Foreign merchandise',
          import_content: 'üè≠ Import content involved',
          incentives: 'üèÜ Production with fiscal incentives'
        },
        recommendations: {
          st: 'Check ICMS-ST collection obligation',
          reduced_bc: 'Confirm percentage of base reduction',
          exemption: 'Keep documents proving exemption/non-taxation',
          suspend_defer: 'Follow when the ICMS will be due',
          icms_paid: 'Verify if ICMS-ST was actually collected',
          special_case: 'Consult specific legislation for the case',
          default: 'Follow normal taxation procedures'
        }
      }
    };

    // Dados do CST em PT e EN (origens, tributacoes, cstsValidos)
    const cstDatabase_pt = {
      origens: {
        "0": "Nacional, exceto as indicadas nos c√≥digos 3, 4, 5 e 8",
        "1": "Estrangeira ‚Äì Importa√ß√£o direta, exceto a indicada no c√≥digo 6",
        "2": "Estrangeira ‚Äì Adquirida no mercado interno, exceto a indicada no c√≥digo 7",
        "3": "Nacional, mercadoria ou bem com Conte√∫do de Importa√ß√£o superior a 40% e igual ou inferior a 70%",
        "4": "Nacional, cuja produ√ß√£o tenha sido feita em conformidade com os processos produtivos b√°sicos de que tratam o Decreto-Lei n¬∫ 288/1967, e as Leis n¬∫s 8.248/1991, 8.387/1991, 10.176/2001 e 11.484/2007",
        "5": "Nacional, mercadoria ou bem com Conte√∫do de Importa√ß√£o inferior ou igual a 40%",
        "6": "Estrangeira ‚Äì Importa√ß√£o direta, sem similar nacional, constante em lista de Resolu√ß√£o Camex e g√°s natural",
        "7": "Estrangeira ‚Äì Adquirida no mercado interno, sem similar nacional, constante em lista de Resolu√ß√£o Camex e g√°s natural",
        "8": "Nacional ‚Äì Mercadoria ou bem com Conte√∫do de Importa√ß√£o superior a 70%"
      },
      tributacoes: {
        "00": { descricao: "Tributada integralmente", significado: "ICMS calculado sobre o valor total da opera√ß√£o", aplicacao: "Opera√ß√µes normais dentro do estado" },
        "10": { descricao: "Tributada e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria", significado: "ICMS normal + ICMS por substitui√ß√£o tribut√°ria", aplicacao: "Opera√ß√µes com ST onde o contribuinte √© o substituto tribut√°rio" },
        "20": { descricao: "Com redu√ß√£o de base de c√°lculo", significado: "Base de c√°lculo reduzida para c√°lculo do ICMS", aplicacao: "Produtos com incentivo fiscal ou al√≠quotas diferenciadas" },
        "30": { descricao: "Isenta ou n√£o tributada e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria", significado: "Opera√ß√£o isenta de ICMS pr√≥prio, mas com ST", aplicacao: "Produtos isentos que t√™m substitui√ß√£o tribut√°ria" },
        "40": { descricao: "Isenta", significado: "N√£o h√° incid√™ncia de ICMS na opera√ß√£o", aplicacao: "Opera√ß√µes com imunidade ou isen√ß√£o espec√≠fica" },
        "41": { descricao: "N√£o tributada", significado: "Opera√ß√£o fora do campo de incid√™ncia do ICMS", aplicacao: "Opera√ß√µes que n√£o se enquadram na legisla√ß√£o do ICMS" },
        "50": { descricao: "Suspens√£o", significado: "ICMS suspenso temporariamente", aplicacao: "Opera√ß√µes com diferimento ou suspens√£o por regime especial" },
        "51": { descricao: "Diferimento", significado: "ICMS adiado para opera√ß√£o futura", aplicacao: "ICMS ser√° pago em etapa posterior da cadeia" },
        "60": { descricao: "ICMS cobrado anteriormente por substitui√ß√£o tribut√°ria", significado: "ICMS j√° foi pago via substitui√ß√£o tribut√°ria", aplicacao: "Opera√ß√µes onde o contribuinte √© o substitu√≠do" },
        "70": { descricao: "Com redu√ß√£o de base de c√°lculo e cobran√ßa do ICMS por substitui√ß√£o tribut√°ria", significado: "Base reduzida + substitui√ß√£o tribut√°ria", aplicacao: "Produtos com incentivo fiscal e que t√™m ST" },
        "90": { descricao: "Outras", significado: "Demais hip√≥teses de tributa√ß√£o", aplicacao: "Regimes especiais ou casos n√£o previstos nos demais c√≥digos" }
      },
      cstsValidos: [
        "000","100","200","300","400","500","600","700","800",
        "010","110","210","310","410","510","610","710","810",
        "020","120","220","320","420","520","620","720","820",
        "030","130","230","330","430","530","630","730","830",
        "040","140","240","340","440","540","640","740","840",
        "041","141","241","341","441","541","641","741","841",
        "050","150","250","350","450","550","650","750","850",
        "051","151","251","351","451","551","651","751","851",
        "060","260","360","460","560","760","860",
        "070","270","370","470","570","770","870",
        "090","190","290","390","490","590","690","790","890"
      ]
    };

    const cstDatabase_en = {
      origens: {
        "0": "National, except those indicated in codes 3, 4, 5 and 8",
        "1": "Foreign - Direct import, except that indicated in code 6",
        "2": "Foreign - Acquired in the domestic market, except that indicated in code 7",
        "3": "National, goods with import content over 40% and up to 70%",
        "4": "National, produced according to specific basic productive processes (incentivized production)",
        "5": "National, goods with import content equal or less than 40%",
        "6": "Foreign - Direct import, without national similar, listed by Camex and natural gas",
        "7": "Foreign - Acquired in domestic market, without national similar, listed by Camex and natural gas",
        "8": "National - Goods with import content over 70%"
      },
      tributacoes: {
        "00": { descricao: "Fully taxed", significado: "ICMS calculated on the total operation value", aplicacao: "Normal in-state operations" },
        "10": { descricao: "Taxed and with ICMS by tax substitution", significado: "Normal ICMS + ICMS by substitution", aplicacao: "Operations with ST where taxpayer is the substitute" },
        "20": { descricao: "With reduction of tax base", significado: "Reduced calculation base for ICMS", aplicacao: "Products with fiscal incentives or special rates" },
        "30": { descricao: "Exempt/non-taxed with tax substitution", significado: "Operation exempt from own ICMS but with ST", aplicacao: "Exempt products that have tax substitution" },
        "40": { descricao: "Exempt", significado: "No ICMS incidence on the operation", aplicacao: "Operations with immunity or specific exemption" },
        "41": { descricao: "Non-taxed", significado: "Operation outside ICMS incidence", aplicacao: "Operations not covered by ICMS legislation" },
        "50": { descricao: "Suspension", significado: "ICMS temporarily suspended", aplicacao: "Operations with deferment or suspension by special regime" },
        "51": { descricao: "Deferment", significado: "ICMS deferred to a future operation", aplicacao: "ICMS will be paid in a later stage" },
        "60": { descricao: "ICMS previously collected by ST", significado: "ICMS already paid via substitution", aplicacao: "Operations where taxpayer is the substituted" },
        "70": { descricao: "Reduced base and ST", significado: "Reduced base + substitution", aplicacao: "Products with fiscal incentive and ST" },
        "90": { descricao: "Others", significado: "Other taxation hypotheses", aplicacao: "Special regimes or cases not listed" }
      },
      cstsValidos: cstDatabase_pt.cstsValidos // same codes
    };

    // Fun√ß√£o util para obter o DB conforme idioma atual
    let currentLocale = 'pt';
    function getCstDB() {
      return currentLocale === 'en' ? cstDatabase_en : cstDatabase_pt;
    }

    // -------------------------
    // L√≥gica de interpreta√ß√£o
    // -------------------------
    class CSTInterpreter {
      constructor(cstCode) {
        this.cstCode = cstCode.toString().padStart(3,'0');
        this.origem = this.cstCode[0];
        this.tributacao = this.cstCode.substring(1);
      }

      isValid() { return getCstDB().cstsValidos.includes(this.cstCode); }

      getOrigemInfo() {
        const db = getCstDB();
        return { codigo: this.origem, descricao: db.origens[this.origem] || (currentLocale === 'en' ? 'Unknown origin' : 'Origem desconhecida') };
      }

      getTributacaoInfo() {
        const db = getCstDB();
        const info = db.tributacoes[this.tributacao];
        return info ? { codigo: this.tributacao, ...info } : { codigo: this.tributacao, descricao: (currentLocale==='en'?'Unknown taxation':'Tributa√ß√£o desconhecida'), significado:'', aplicacao:'' };
      }

      // Retorna CODES de caracter√≠sticas (para traduzir na UI)
      detectarCaracteristicas() {
        const features = [];
        const trib = this.tributacao;
        if (trib === '00') features.push('tax_normal');
        if (['10','30','70'].includes(trib)) features.push('st');
        if (['20','70'].includes(trib)) features.push('reduced_bc');
        if (['40','41'].includes(trib)) features.push('exemption');
        if (['50','51'].includes(trib)) features.push('suspend_defer');
        if (trib === '60') features.push('icms_paid');
        if (trib === '90') features.push('special_case');
        if (['1','2','6','7'].includes(this.origem)) features.push('foreign');
        if (['3','5','8'].includes(this.origem)) features.push('import_content');
        if (['4'].includes(this.origem)) features.push('incentives');
        return features;
      }

      // Retorna CODES de recomenda√ß√µes
      gerarRecomendacoes() {
        const rec = [];
        const trib = this.tributacao;
        if (['10','30','70'].includes(trib)) rec.push('st');
        if (['20','70'].includes(trib)) rec.push('reduced_bc');
        if (['40','41'].includes(trib)) rec.push('exemption');
        if (['50','51'].includes(trib)) rec.push('suspend_defer');
        if (trib === '60') rec.push('icms_paid');
        if (trib === '90') rec.push('special_case');
        return rec.length ? rec : ['default'];
      }

      interpretar() {
        const L = locales[currentLocale];
        if (!this.isValid()) return { valido:false, erro:`CST ${this.cstCode} ${L.alerts.notValid}` };
        return {
          valido:true,
          cst:this.cstCode,
          origem:this.getOrigemInfo(),
          tributacao:this.getTributacaoInfo(),
          caracteristicas:this.detectarCaracteristicas(),
          recomendacoes:this.gerarRecomendacoes()
        };
      }
    }

    // -------------------------
    // UI, eventos e inicializa√ß√£o
    // -------------------------
    const langToggle = document.getElementById('langToggle');
    const langElements = {
      title: document.getElementById('title'),
      subtitle: document.getElementById('subtitle'),
      cstInput: document.getElementById('cstInput'),
      interpretBtn: document.getElementById('interpretBtn'),
      validTitle: document.getElementById('validTitle'),
      emptyMsg: document.getElementById('emptyMsg')
    };

    function applyLocale() {
      const L = locales[currentLocale];
      langElements.title.textContent = L.title;
      langElements.subtitle.textContent = L.subtitle;
      langElements.cstInput.placeholder = L.inputPlaceholder;
      langElements.interpretBtn.textContent = L.interpretBtn;
      langElements.validTitle.textContent = L.validTitle;
      langElements.emptyMsg.textContent = L.emptyMsg;
      langToggle.textContent = currentLocale === 'pt' ? 'EN' : 'PT';
    }

    function interpretarCST() {
      const input = document.getElementById('cstInput').value.trim();
      const resultSection = document.getElementById('resultSection');
      const L = locales[currentLocale];

      if (!input) {
        resultSection.innerHTML = `<div class="error"><p>${L.alerts.enterCst}</p></div>`;
        return;
      }
      if (!/^\d{3}$/.test(input)) {
        resultSection.innerHTML = `<div class="error"><p>${L.alerts.invalidFormat}</p></div>`;
        return;
      }

      const interpreter = new CSTInterpreter(input);
      const resultado = interpreter.interpretar();

      if (!resultado.valido) {
        resultSection.innerHTML = `<div class="error"><p>${resultado.erro}</p><p style="margin-top:10px;">${L.alerts.consultList}</p></div>`;
        return;
      }

      // map features/recommendations codes to localized strings
      const featureTexts = resultado.caracteristicas.map(code => locales[currentLocale].features[code] || code);
      const recTexts = resultado.recomendacoes.map(code => locales[currentLocale].recommendations[code] || code);

      let html = `
        <div class="result-card">
          <h2 class="result-title">üè∑Ô∏è CST: ${resultado.cst} <span class="origin-badge">Origem ${resultado.origem.codigo}</span> <span class="tax-badge">Tributa√ß√£o ${resultado.tributacao.codigo}</span></h2>
          <div class="result-detail"><strong>üìç ${currentLocale === 'pt' ? 'Origem' : 'Origin'}:</strong> ${resultado.origem.descricao}</div>
          <div class="result-detail"><strong>üí∞ ${currentLocale === 'pt' ? 'Tributa√ß√£o' : 'Taxation'}:</strong> ${resultado.tributacao.descricao}</div>
          <div class="result-detail"><strong>üìã ${currentLocale === 'pt' ? 'Significado' : 'Meaning'}:</strong> ${resultado.tributacao.significado}</div>
          <div class="result-detail"><strong>üéØ ${currentLocale === 'pt' ? 'Aplica√ß√£o' : 'Application'}:</strong> ${resultado.tributacao.aplicacao}</div>
          <div class="features"><h4>üîç ${currentLocale === 'pt' ? 'Caracter√≠sticas Identificadas' : 'Identified Characteristics'}:</h4>${featureTexts.map(t=>`<div class="feature-item">${t}</div>`).join('')}</div>
          <div class="features" style="background:#d4edda;border-color:#c3e6cb;"><h4>üí° ${currentLocale === 'pt' ? 'Recomenda√ß√µes' : 'Recommendations'}:</h4>${recTexts.map(r=>`<div class="feature-item">‚Ä¢ ${r}</div>`).join('')}</div>
        </div>
      `;
      resultSection.innerHTML = html;
    }

    function inicializarCstsValidos() {
      const grid = document.getElementById('validCstsGrid');
      grid.innerHTML = '';
      getCstDB().cstsValidos.forEach(cst=>{
        const div = document.createElement('div');
        div.className = 'cst-item';
        div.textContent = cst;
        div.title = `Clicar para preencher: ${cst}`;
        div.onclick = ()=>{ document.getElementById('cstInput').value = cst; interpretarCST(); };
        grid.appendChild(div);
      });
    }

    // Event listeners
    document.getElementById('interpretBtn').addEventListener('click', interpretarCST);
    document.getElementById('cstInput').addEventListener('keypress', e => { if (e.key === 'Enter') interpretarCST(); });
    document.getElementById('cstInput').addEventListener('input', function(){ this.value = this.value.replace(/[^0-9]/g,'').slice(0,3); });

    langToggle.addEventListener('click', () => {
      currentLocale = currentLocale === 'pt' ? 'en' : 'pt';
      applyLocale();
      inicializarCstsValidos(); // atualiza a listagem se necess√°rio
    });

    // Inicializar
    document.addEventListener('DOMContentLoaded', () => { applyLocale(); inicializarCstsValidos(); });
  </script>
</body>
</html>
